<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spine Animation to PNG Sequence</title>
    <script src="https://pixijs.download/v8.8.1/pixi.min.js"></script>
    <script src="https://unpkg.com/@esotericsoftware/spine-pixi-v8@4.2.*/dist/iife/spine-pixi-v8.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
      body {
        margin: 0; /* Remove default margins */
        overflow: hidden; /* Prevent scrollbars */
      }
      canvas {
        display: block; /* Remove unwanted margins around canvas */
      }
      #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 100;
        background: rgba(255, 255, 255, 0.7);
        padding: 10px;
        border-radius: 5px;
      }
      #progress {
        margin-top: 10px;
        display: none;
      }
      progress {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <button id="exportButton">Export PNG Sequence</button>
      <span id="status"></span>
      <div id="progress">
        <progress id="progressBar" value="0" max="100"></progress>
        <div id="progressText">0%</div>
      </div>
    </div>
    <script>
      (async () => {
        const app = new PIXI.Application();
        app.init({
          resizeTo: window,
          antialias: true,
          resolution: window.devicePixelRatio, // Ensure high-DPI scaling
          autoDensity: true, // Prevent blurry rendering
          transparent: true, // Enable transparency for the canvas
        });

        await PIXI.Assets.load([
          {
            alias: "spineSkel",
            src: "./spines/Eff_UI_SumeruBirthFloatToyLoading_Spine01.skel",
          },
          {
            alias: "spineAtlas",
            src: "./spines/Eff_UI_SumeruBirthFloatToyLoading_Spine01.atlas",
          },
        ]);
        const spineData = spine.Spine.from({
          skeleton: "spineSkel",
          atlas: "spineAtlas",
        });
        app.stage.addChild(spineData);
        spineData.state.setAnimation(0, "In", false);
        spineData.state.addListener({
          complete: (entry) => {
            spineData.state.setAnimation(0, "Loop", true);
          },
        });

        // await app.loader
        //   .add("spine", "./spines/Eff_UI_SumeruBirthFloatToyLoading_Spine01.skel")
        //   .load((loader, resources) => {
        //     sumeruCartSpine = new PIXI.spine.Spine(resources.spine.spineData);
        //     if (sumeruCartSpine) {
        //       const scaleFactor = Math.min(
        //         window.innerWidth / 1100, // Scale relative to width
        //         window.innerHeight / 1100 // Scale relative to height
        //       );
        //       sumeruCartSpine.scale.set(scaleFactor); // Apply uniform scaling
        //       sumeruCartSpine.x = app.screen.width / 2;
        //       sumeruCartSpine.y = app.screen.height / 2 + sumeruCartSpine.height / 2;
        //     }
        //     app.stage.addChild(sumeruCartSpine);

        //     // Start with the "In" animation
        //     sumeruCartSpine.state.setAnimation(0, "In", false);

        //     // When "In" animation completes, switch to "Loop"
        //     sumeruCartSpine.state.addListener({
        //       complete: (entry) => {
        //         if (entry.animation.name === "In" && !isExporting) {
        //           sumeruCartSpine.state.setAnimation(0, "Loop", true);
        //         }
        //       },
        //     });

        // Enable the export button once animation is loaded
        exportButton.disabled = false;
      })();
    </script>
  </body>
</html>
